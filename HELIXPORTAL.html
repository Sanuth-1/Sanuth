<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>HELIX PORTAL</title>
</head>
<body>
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academic Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Source+Serif+4:wght@600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #203647;
      --accent: #5a94e2;
      --accent-light: #e7f1ff;
      --bg1: #eef3f8;
      --bg2: #f7fafc;
      --card: #fff;
      --border: #dde4ec;
      --radius: 13px;
      --shadow: 0 6px 32px 0 rgba(58,80,120,.08);
      --shadow-sm: 0 2px 10px 0 rgba(40,50,70,.08);
      --danger: #e55252;
      --success: #48b87d;
      --nav-h: 60px;
      --font-serif: 'Source Serif 4', serif;
      --font-sans: 'Roboto', Arial, sans-serif;
    }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, var(--bg1) 55%, var(--bg2) 100%);
      margin: 0;
      font-family: var(--font-sans);
      color: #253858;
      font-size: 17px;
    }
    #app { min-height: 100vh; }
    h1,h2,h3 {
      font-family: var(--font-serif);
      color: var(--primary);
      margin-top: 0;
      font-weight: 600;
      letter-spacing: 0.01em;
    }
    h1 { font-size: 2.2em; }
    h2 { font-size: 1.5em; }
    h3 { font-size: 1.18em; }
    a { color: var(--accent); text-decoration: none; transition: color 0.2s;}
    a:hover { text-decoration: underline; color: #185bbc; }
    label { font-size: 1em; color: #374151; margin-bottom: 5px; display: block;}
    .centered-card {
      max-width: 430px;
      margin: 8vh auto 0 auto;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2.4em 2em 2em 2em;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 0.4em;
      animation: fadeIn .7s;
    }
    .form-title { margin-bottom: 1.25em; }
    .button {
      background: linear-gradient(90deg, var(--accent) 70%, #399fff 100%);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      padding: 0.9em 1.6em;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: background 0.2s, box-shadow 0.2s;
      margin-top: 0.1em;
      margin-bottom: 1.1em;
    }
    .button:hover { background: #2051af; box-shadow:0 2px 24px #3079ed33;}
    .button.alt { background: #f6f8fa; color: var(--primary); box-shadow: none; }
    .button.danger { background: var(--danger);}
    .button.small { font-size: 0.96em; padding: 0.6em 1.1em;}
    input, textarea, select {
      width: 100%;
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 0.7em;
      margin-bottom: 1em;
      font-size: 1em;
      background: #fafdff;
      box-sizing: border-box;
      font-family: inherit;
      outline: none;
      transition: border-color 0.18s;
    }
    input:focus, textarea:focus, select:focus { border-color: var(--accent);}
    .error { color: #b20000; margin-bottom: 1em; font-size: 1.01em;}
    .success { color: var(--success); margin-bottom: 1em; font-size: 1.01em;}
    .navbar {
      background: #fff;
      color: var(--primary);
      height: var(--nav-h);
      box-shadow: 0 2px 16px 0 #20344a12;
      padding: 0 2.2em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      position: sticky;
      top: 0;
    }
    .navbar h1 {
      font-family: var(--font-serif);
      font-weight: 700;
      font-size: 1.45em;
      color: var(--primary);
      margin: 0;
      letter-spacing:0.01em;
    }
    .navbar .nav-links {
      display: flex;
      align-items: center;
      gap: 2em;
    }
    .navbar .nav-links a {
      color: var(--primary);
      font-weight: 500;
      font-size: 1.02em;
      padding: 6px 0;
      border-bottom: 2.5px solid transparent;
      transition: color 0.15s, border-color 0.2s;
      margin-left: 0.5em;
    }
    .navbar .nav-links a.active, .navbar .nav-links a:focus {
      color: var(--accent);
      border-bottom: 2.5px solid var(--accent);
    }
    .dashboard {
      max-width: 980px;
      margin: 2.5em auto 2em auto;
      padding: 2.4em 1.5em 2em 1.5em;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      animation: fadeIn .7s;
    }
    .section { margin-bottom: 2.3em;}
    .card-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
      gap: 1.35em;
    }
    .card {
      background: #fafdff;
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      padding: 1.25em 1em 1em 1em;
      margin-bottom: 1em;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 0.4em;
    }
    .card b { color: #24406e; font-size: 1.08em;}
    .comment-section { margin-top: 1.3em;}
    .comment-list { margin: 0; padding: 0; list-style: none;}
    .comment-list li {
      background: #ecf2fa;
      border-radius: var(--radius);
      margin-bottom: 0.7em;
      padding: 0.85em 0.75em 0.65em 0.75em;
      font-size: 1em;
      box-shadow: 0 1px 4px #29437a10;
      border-left: 3.5px solid #aed0ff;
    }
    .comment-list .author { font-weight: 600; color: var(--primary); margin-right: 0.7em;}
    .comment-list .date { color: #999; font-size: 0.93em; margin-left: 0.7em;}
    .tabs { display: flex; gap: 1em; margin-bottom: 1.3em;}
    .tab {
      padding: 0.6em 1.3em;
      border-radius: var(--radius);
      cursor: pointer;
      background: #f1f3fa;
      color: #345;
      font-weight: 500;
      border: 1.8px solid transparent;
      font-family: var(--font-sans);
      font-size: 1.02em;
      transition: all 0.15s;
    }
    .tab.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      box-shadow: 0 2px 14px #3079ed13;
    }
    .fade { animation: fadeIn .7s;}
    @keyframes fadeIn { from { opacity:0; transform: translateY(18px);} to   { opacity:1; transform: translateY(0);}}
    .table-wrap { overflow-x:auto;}
    table.timetable {
      border-collapse: collapse;
      width: 100%;
      background: #fafdff;
      border-radius: var(--radius);
      box-shadow: 0 1px 10px #3079ed11;
      margin-bottom:1.5em;
    }
    table.timetable th, table.timetable td {
      border: 1px solid var(--border);
      padding: 0.7em 0.8em;
      text-align: left;
      font-size: 1em;
    }
    table.timetable th {
      background: var(--accent-light);
      color: var(--primary);
      font-weight: 700;
      font-family: var(--font-sans);
      font-size: 1em;
    }
    table.timetable td { background: #fff;}
    .table-actions button {
      margin-right: 0.35em;
      margin-bottom: 2px;
    }
    .pdf-link {
      background: #e8f2ff;
      color: #2253a7;
      padding: 4px 10px 4px 7px;
      border-radius: 5px;
      font-size: 1em;
      margin-right: 10px;
      display: inline-block;
      margin-bottom: 8px;
      text-decoration: none;
    }
    .pdf-link:hover { background: #d5e7ff; }
    .pdf-filename { font-size: 0.97em; }
    @media (max-width: 700px) {
      .navbar { padding:0 0.7em; }
      .dashboard { padding: 1.15em 0.45em 1.2em 0.45em;}
      .card-list { grid-template-columns: 1fr;}
      .centered-card { padding: 1.5em 0.7em 1.2em 0.7em;}
      table.timetable th, table.timetable td { font-size:0.97em; padding:0.65em 0.32em;}
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    // ===== Academic Portal with Admin User Delete, Forgot/Change Password =====
    const ADMIN_CODE = "HELIX28"; // Only this code gives admin rights
    const LS = {
      get(k, d){return JSON.parse(localStorage.getItem(k))||d;},
      set(k, v){localStorage.setItem(k,JSON.stringify(v));}
    };
    function seedData() {
      if (!LS.get('users', null)) {
        LS.set('users', [
          {id:1,name:'Admin',email:'admin@sch.edu',password:'admin123',role:'admin'}
        ]);
      }
      if (!LS.get('timetable', null)) {
        LS.set('timetable', [
          {id:1, course:'MTH101', day:'Monday', time:'9:00-11:00', venue:'Hall A'},
          {id:2, course:'PHY102', day:'Tuesday', time:'11:00-13:00', venue:'Hall B'}
        ]);
      }
      if (!LS.get('materials', null)) LS.set('materials', []);
      if (!LS.get('results', null)) LS.set('results', []);
      if (!LS.get('comments', null)) LS.set('comments', []);
    }
    seedData();

    function route(view, ...args) {
      window.location.hash = '#' + view + (args.length ? '/' + args.join('/') : '');
    }
    window.addEventListener('hashchange', renderApp);
    window.addEventListener('DOMContentLoaded', renderApp);

    let State = { user: null };
    function byId(id) { return document.getElementById(id); }
    function html(strings, ...values) {
      let str = strings[0];
      values.forEach((v, i) => str += v + strings[i+1]);
      return str;
    }
    function formatDate(iso) {
      const d = new Date(iso);
      return d.toLocaleString();
    }

    function login(email, password) {
      const users = LS.get('users', []);
      const user = users.find(u => u.email === email && u.password === password);
      if (user) {
        LS.set('session', user.id);
        State.user = user;
        return true;
      }
      return false;
    }
    function register(name, email, password, adminCode) {
      let users = LS.get('users', []);
      if (users.find(u => u.email === email)) return {success:false, msg:"Email already registered"};
      const id = users.length ? Math.max(...users.map(u => u.id)) + 1 : 1;
      let role = "student";
      if (adminCode && adminCode === ADMIN_CODE) role = "admin";
      else if (adminCode && adminCode !== "") return {success:false, msg:"Invalid admin code"};
      const user = { id, name, email, password, role };
      users.push(user);
      LS.set('users', users);
      return {success:true, role};
    }
    function logout() {
      LS.set('session', null);
      State.user = null;
      route('login');
    }
    function getCurrentUser() {
      const id = LS.get('session', null);
      if (!id) return null;
      const users = LS.get('users', []);
      return users.find(u => u.id === id) || null;
    }
    function renderApp() {
      State.user = getCurrentUser();
      const hash = window.location.hash.replace(/^#/, '') || 'login';
      const [view, param] = hash.split('/');
      if (!State.user && !["register","forgot","reset"].includes(view)) {
        renderLogin();
        return;
      }
      if (State.user && view === 'login') {
        route('dashboard');
        return;
      }
      if (view === 'admin' && (!State.user || State.user.role !== 'admin')) {
        alert("Only admin can access the admin panel.");
        route('dashboard');
        return;
      }
      switch (view) {
        case 'login': renderLogin(); break;
        case 'register': renderRegister(); break;
        case 'forgot': renderForgot(); break;
        case 'reset': renderReset(param); break;
        case 'dashboard': renderDashboard(); break;
        case 'admin': renderAdmin(); break;
        default: renderLogin();
      }
      highlightActiveNav();
    }
    function highlightActiveNav() {
      const navLinks = document.querySelectorAll('.nav-links a');
      if (!navLinks) return;
      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === window.location.hash) link.classList.add('active');
      });
    }
    function renderNavbar() {
      return html`
        <nav class="navbar">
          <h1>Academic Portal</h1>
          <div class="nav-links">
            <a href="#dashboard">Home</a>
            ${State.user.role === 'admin' ? `<a href="#admin">Admin Panel</a>` : ''}
            <a href="javascript:void(0)" onclick="logout()">Logout</a>
          </div>
        </nav>
      `;
    }
    function renderLogin() {
      document.title = 'Login - Academic Portal';
      byId('app').innerHTML = html`
        <div class="centered-card fade">
          <h2 class="form-title">Login</h2>
          <form id="loginForm">
            <label>Email</label>
            <input required type="email" name="email" autocomplete="username" />
            <label>Password</label>
            <input required type="password" name="password" autocomplete="current-password" />
            <div id="loginErr" class="error"></div>
            <button class="button" type="submit">Login</button>
            <div style="margin-top:0.5em;text-align:center;font-size:0.98em;">
              <a href="#register">No account? Register</a>
              <span style="color:#aaa">|</span>
              <a href="#forgot">Forgot password?</a>
            </div>
          </form>
        </div>
      `;
      byId('loginForm').onsubmit = function(e) {
        e.preventDefault();
        const email = this.email.value.trim(), password = this.password.value;
        if (login(email, password)) route('dashboard');
        else byId('loginErr').textContent = 'Invalid email or password';
      };
    }
    function renderRegister() {
      document.title = 'Register - Academic Portal';
      byId('app').innerHTML = html`
        <div class="centered-card fade">
          <h2 class="form-title">Create Account</h2>
          <form id="regForm">
            <label>Full Name</label>
            <input required name="name" />
            <label>Email</label>
            <input required type="email" name="email" />
            <label>Password</label>
            <input required type="password" name="password" />
            <label>Admin code <span style="color:#aaa;font-size:0.98em;">(only for admins)</span></label>
            <input name="adminCode" placeholder="Enter admin code to register as admin" />
            <div id="regErr" class="error"></div>
            <button class="button" type="submit">Register</button>
            <div style="margin-top:1em;text-align:center;font-size:0.98em;">
              <a href="#login">Already have an account? Login</a>
            </div>
          </form>
          <div style="margin-top:1.1em;font-size:0.99em;color:#888;text-align:center;">
            <span style="background:#e5eaf3;padding:2px 8px;border-radius:6px;"></span>
          </div>
        </div>
      `;
      byId('regForm').onsubmit = function(e) {
        e.preventDefault();
        const name = this.name.value.trim(), email = this.email.value.trim(), password = this.password.value;
        const adminCode = this.adminCode.value.trim();
        if (!name || !email || !password) return;
        const result = register(name, email, password, adminCode);
        if (result.success) {
          if(result.role === "admin") alert("Admin account created. You can now log in as admin.");
          route('login');
        } else byId('regErr').textContent = result.msg;
      };
    }
    function renderForgot() {
      document.title = 'Forgot Password - Academic Portal';
      byId('app').innerHTML = html`
        <div class="centered-card fade">
          <h2 class="form-title">Forgot Password</h2>
          <form id="forgotForm">
            <label>Enter your registered email</label>
            <input required type="email" name="email" />
            <div id="forgotErr" class="error"></div>
            <div id="forgotMsg" class="success"></div>
            <button class="button" type="submit">Continue</button>
            <div style="margin-top:1em;text-align:center;font-size:0.98em;">
              <a href="#login">Back to login</a>
            </div>
          </form>
        </div>
      `;
      byId('forgotForm').onsubmit = function(e) {
        e.preventDefault();
        const email = this.email.value.trim();
        const users = LS.get('users', []);
        const user = users.find(u => u.email === email);
        if (!user) {
          byId('forgotErr').textContent = "No such user found!";
          byId('forgotMsg').textContent = "";
        } else {
          byId('forgotErr').textContent = "";
          byId('forgotMsg').textContent = "Account found. You can now reset your password.";
          setTimeout(() => route('reset', encodeURIComponent(email)), 1200);
        }
      };
    }
    function renderReset(emailParam) {
      document.title = 'Reset Password - Academic Portal';
      const email = decodeURIComponent(emailParam||'');
      byId('app').innerHTML = html`
        <div class="centered-card fade">
          <h2 class="form-title">Reset Password</h2>
          <form id="resetForm">
            <label>Email</label>
            <input required type="email" name="email" value="${email}" readonly />
            <label>New Password</label>
            <input required type="password" name="password" />
            <div id="resetErr" class="error"></div>
            <div id="resetMsg" class="success"></div>
            <button class="button" type="submit">Reset Password</button>
            <div style="margin-top:1em;text-align:center;font-size:0.98em;">
              <a href="#login">Back to login</a>
            </div>
          </form>
        </div>
      `;
      byId('resetForm').onsubmit = function(e) {
        e.preventDefault();
        const email = this.email.value.trim(), password = this.password.value;
        let users = LS.get('users', []);
        const idx = users.findIndex(u => u.email === email);
        if (idx === -1) {
          byId('resetErr').textContent = "User not found!";
          return;
        }
        users[idx].password = password;
        LS.set('users', users);
        byId('resetErr').textContent = "";
        byId('resetMsg').textContent = "Password changed. You can now login.";
        setTimeout(() => route('login'), 1400);
      };
    }
    function renderDashboard() {
      document.title = 'Dashboard - Academic Portal';
      const timetable = LS.get('timetable', []);
      const materials = LS.get('materials', []);
      byId('app').innerHTML = html`
        ${renderNavbar()}
        <div class="dashboard fade">
          <h2>Welcome, ${State.user.name}!</h2>
          <div class="section">
            <h3>Time Table</h3>
            <div class="table-wrap">
              <table class="timetable">
                <thead>
                  <tr>
                    <th>Course</th>
                    <th>Day</th>
                    <th>Time</th>
                    <th>Venue</th>
                  </tr>
                </thead>
                <tbody>
                  ${timetable.length ? timetable.map(row => `
                    <tr>
                      <td>${row.course}</td>
                      <td>${row.day}</td>
                      <td>${row.time}</td>
                      <td>${row.venue}</td>
                    </tr>
                  `).join('') : `<tr><td colspan="4" style="text-align:center;color:#bbb;">No timetable set yet.</td></tr>`}
                </tbody>
              </table>
            </div>
          </div>
          <div class="section">
            <h3>Course Materials</h3>
            ${materials.length ? `
              ${materials.map(m => `
                <a class="pdf-link" href="${m.fileData ? m.fileData : m.fileUrl}" download="${m.fileName}" target="_blank">
                  &#128196; <span class="pdf-filename">${m.fileName}</span>
                </a>
              `).join('')}
            ` : '<div style="color:#bbb;">No materials uploaded yet.</div>'}
          </div>
        </div>
      `;
      highlightActiveNav();
    }
    function renderAdmin() {
      document.title = 'Admin Panel - Academic Portal';
      let tab = window.__admintab || 'timetable';
      function setTab(t) { window.__admintab = t; renderAdmin(); }
      const timetable = LS.get('timetable', []);
      const materials = LS.get('materials', []);
      const users = LS.get('users', []);
      byId('app').innerHTML = html`
        ${renderNavbar()}
        <div class="dashboard fade">
          <h2>Admin Panel</h2>
          <div class="tabs">
            <div class="tab ${tab === 'timetable' ? 'active' : ''}" onclick="window.__admintab='timetable';renderAdmin();">Time Table</div>
            <div class="tab ${tab === 'materials' ? 'active' : ''}" onclick="window.__admintab='materials';renderAdmin();">Course Materials</div>
            <div class="tab ${tab === 'users' ? 'active' : ''}" onclick="window.__admintab='users';renderAdmin();">Users</div>
          </div>
          <div>
            ${tab === 'timetable' ? adminTimetable() : ''}
            ${tab === 'materials' ? adminMaterials() : ''}
            ${tab === 'users' ? adminUsers() : ''}
          </div>
        </div>
      `;

      function adminTimetable() {
        return html`
          <form id="ttForm" style="margin-bottom:1.5em;">
            <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:1em;">
              <div>
                <label>Course</label>
                <input required name="course" placeholder="e.g. MTH101" />
              </div>
              <div>
                <label>Day</label>
                <input required name="day" placeholder="e.g. Monday" />
              </div>
              <div>
                <label>Time</label>
                <input required name="time" placeholder="e.g. 9:00-11:00" />
              </div>
              <div>
                <label>Venue</label>
                <input required name="venue" placeholder="e.g. Hall A" />
              </div>
            </div>
            <button class="button small" type="submit" style="margin-top:1em;">Add</button>
          </form>
          <div class="table-wrap">
            <table class="timetable">
              <thead>
                <tr>
                  <th>Course</th>
                  <th>Day</th>
                  <th>Time</th>
                  <th>Venue</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${timetable.length ? timetable.map(row => `
                  <tr id="row-${row.id}">
                    <td>${row.course}</td>
                    <td>${row.day}</td>
                    <td>${row.time}</td>
                    <td>${row.venue}</td>
                    <td class="table-actions">
                      <button class="button small" type="button" onclick="editRow(${row.id})">Edit</button>
                      <button class="button small danger" type="button" onclick="deleteRow(${row.id})">Delete</button>
                    </td>
                  </tr>
                `).join('') : `<tr><td colspan="5" style="text-align:center;color:#bbb;">No timetable set yet.</td></tr>`}
              </tbody>
            </table>
          </div>
        `;
      }
      function adminMaterials() {
        return html`
          <form id="matForm" style="margin-bottom:2em;" enctype="multipart/form-data">
            <label>Select PDF file</label>
            <input type="file" accept="application/pdf" required name="pdf" />
            <div id="matErr" class="error"></div>
            <button class="button" type="submit">Upload PDF</button>
          </form>
          <div>
            <h3>Uploaded Materials</h3>
            ${materials.length ? `
              ${materials.map(m => `
                <a class="pdf-link" href="${m.fileData ? m.fileData : m.fileUrl}" download="${m.fileName}" target="_blank">
                  &#128196; <span class="pdf-filename">${m.fileName}</span>
                </a>
                <button class="button small danger" style="margin-left:8px" onclick="deleteMaterial('${m.id}')">Delete</button>
                <br/>
              `).join('')}
            ` : '<div style="color:#bbb;">No materials uploaded yet.</div>'}
          </div>
        `;
      }
      function adminUsers() {
        return html`
          <div>
            <h3>All Users</h3>
            <table class="timetable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${users.length ? users.map(u => `
                  <tr>
                    <td>${u.name}</td>
                    <td>${u.email}</td>
                    <td>${u.role}</td>
                    <td>
                      ${u.id === State.user.id ? '<span style="color:#aaa;">(You)</span>' : `<button class="button small danger" onclick="deleteUser(${u.id})">Delete</button>`}
                    </td>
                  </tr>
                `).join('') : `<tr><td colspan="4" style="text-align:center;color:#bbb;">No users found.</td></tr>`}
              </tbody>
            </table>
            <div style="color:#e55252;font-size:0.97em;">* Deleting a user is permanent and cannot be undone.</div>
          </div>
        `;
      }
      // Timetable handlers
      if (tab === 'timetable' && byId('ttForm')) {
        byId('ttForm').onsubmit = function(e) {
          e.preventDefault();
          let timetable = LS.get('timetable', []);
          const id = timetable.length ? Math.max(...timetable.map(r => r.id)) + 1 : 1;
          timetable.push({
            id,
            course:this.course.value.trim(),
            day:this.day.value.trim(),
            time:this.time.value.trim(),
            venue:this.venue.value.trim()
          });
          LS.set('timetable', timetable);
          renderAdmin();
        };
      }
      window.editRow = function(id) {
        let timetable = LS.get('timetable', []);
        const row = timetable.find(r => r.id === id);
        if (!row) return;
        const tr = byId('row-' + id);
        if (!tr) return;
        tr.innerHTML = `
          <td><input id="ecourse" value="${row.course}" /></td>
          <td><input id="eday" value="${row.day}" /></td>
          <td><input id="etime" value="${row.time}" /></td>
          <td><input id="evenue" value="${row.venue}" /></td>
          <td>
            <button class="button small" onclick="saveRow(${id})">Save</button>
            <button class="button small danger" onclick="renderAdmin()">Cancel</button>
          </td>
        `;
        window.saveRow = function(id) {
          timetable = LS.get('timetable', []);
          const idx = timetable.findIndex(r => r.id === id);
          if (idx < 0) return;
          timetable[idx].course = byId('ecourse').value.trim();
          timetable[idx].day = byId('eday').value.trim();
          timetable[idx].time = byId('etime').value.trim();
          timetable[idx].venue = byId('evenue').value.trim();
          LS.set('timetable', timetable);
          renderAdmin();
        }
      };
      window.deleteRow = function(id) {
        let timetable = LS.get('timetable', []);
        if (!confirm("Delete this row?")) return;
        timetable = timetable.filter(r => r.id !== id);
        LS.set('timetable', timetable);
        renderAdmin();
      }
      // PDF upload handler
      if (tab === 'materials' && byId('matForm')) {
        byId('matForm').onsubmit = function(e) {
          e.preventDefault();
          const file = this.pdf.files[0];
          if (!file || file.type !== "application/pdf") {
            byId('matErr').textContent = "Only PDF files allowed.";
            return;
          }
          const reader = new FileReader();
          reader.onload = function(evt) {
            let materials = LS.get('materials', []);
            const id = Date.now();
            materials.push({
              id,
              fileName: file.name,
              fileData: evt.target.result
            });
            LS.set('materials', materials);
            renderAdmin();
          };
          reader.readAsDataURL(file);
        };
      }
      window.deleteMaterial = function(id) {
        let materials = LS.get('materials', []);
        materials = materials.filter(m => m.id != id);
        LS.set('materials', materials);
        renderAdmin();
      }
      // User delete handler
      window.deleteUser = function(id) {
        if (!confirm("Are you sure you want to permanently delete this user?")) return;
        let users = LS.get('users', []);
        users = users.filter(u => u.id !== id);
        LS.set('users', users);
        // Remove session if deleting currently logged-in user
        if (State.user && State.user.id === id) {
          logout();
        } else {
          renderAdmin();
        }
      };
      highlightActiveNav();
    }
    window.logout = logout;
    window.renderAdmin = renderAdmin;
  </script>
</body>
</html>
</body>
</html>