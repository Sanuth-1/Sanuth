<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helix - Student Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs, updateDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB0--bDqGPckl7pENJLMN_95fDNAaXR4zs",
            authDomain: "helixfinale.firebaseapp.com",
            projectId: "helixfinale",
            storageBucket: "helixfinale.firebasestorage.app",
            messagingSenderId: "556896526389",
            appId: "1:556896526389:web:0579fb75c4953f716cd17c",
            measurementId: "G-HB0DND8V2J"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);

        // Make Firebase services globally available
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseServices = {
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            sendPasswordResetEmail,
            doc,
            setDoc,
            getDoc,
            collection,
            addDoc,
            getDocs,
            updateDoc,
            deleteDoc,
            query,
            orderBy
        };
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Dark theme styles */
        .dark {
            background-color: #1a1a1a;
            color: #e5e5e5;
        }
        
        .dark .bg-white {
            background-color: #2d2d2d !important;
            color: #e5e5e5 !important;
        }
        
        .dark .bg-gray-50 {
            background-color: #1a1a1a !important;
        }
        
        .dark .text-gray-800 {
            color: #e5e5e5 !important;
        }
        
        .dark .text-gray-700 {
            color: #d1d1d1 !important;
        }
        
        .dark .text-gray-600 {
            color: #a3a3a3 !important;
        }
        
        .dark .text-gray-500 {
            color: #8a8a8a !important;
        }
        
        .dark .border-gray-300 {
            border-color: #4a4a4a !important;
        }
        
        .dark .border-gray-200 {
            border-color: #3a3a3a !important;
        }
        
        .dark .bg-blue-50 {
            background-color: #1e3a5f !important;
        }
        
        .dark .bg-green-50 {
            background-color: #1e3a2e !important;
        }
        
        .dark .bg-yellow-50 {
            background-color: #3a3a1e !important;
        }
        
        .dark .bg-purple-50 {
            background-color: #2e1e3a !important;
        }
        
        .dark .hover\:bg-gray-50:hover {
            background-color: #3a3a3a !important;
        }
        
        .dark input,
        .dark textarea {
            background-color: #3a3a3a !important;
            color: #e5e5e5 !important;
            border-color: #4a4a4a !important;
        }
        
        .dark input:focus,
        .dark textarea:focus {
            border-color: #60a5fa !important;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2) !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-dna text-2xl"></i>
                    <h1 class="text-xl font-bold">Helix</h1>
                </div>
                <div id="nav-menu" class="hidden md:flex space-x-6">
                    <!-- Navigation items will be populated by JavaScript -->
                </div>
                <div class="flex items-center space-x-3">
                    <!-- Theme Toggle -->
                    <button id="theme-toggle" onclick="toggleTheme()" class="p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition duration-300" title="Toggle Theme">
                        <i id="theme-icon" class="fas fa-moon text-lg"></i>
                    </button>
                    
                    <!-- Home Button (only show when logged in) -->
                    <button id="home-button" onclick="goHome()" class="hidden p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition duration-300" title="Go to Homepage">
                        <i class="fas fa-home text-lg"></i>
                    </button>
                    
                    <div id="auth-buttons" class="flex space-x-3">
                        <!-- Auth buttons will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Login/Signup Section -->
        <div id="auth-section" class="fade-in">
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-dna text-4xl text-blue-600 mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Welcome to Helix</h2>
                    <p class="text-gray-600 mt-2">Year 1 Student Portal</p>
                    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-center justify-center space-x-2 text-blue-700">
                            <i class="fas fa-cloud text-sm"></i>
                            <span class="text-sm font-medium">Firebase Backend Active</span>
                        </div>
                        <p class="text-xs text-blue-600 mt-1">Real-time cloud database with authentication</p>
                    </div>
                </div>

                <!-- Login Form -->
                <div id="login-form">
                    <h3 class="text-xl font-semibold mb-4 text-center">Login</h3>
                    <form onsubmit="handleLogin(event)">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                            <input type="email" id="login-email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                            <input type="password" id="login-password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login
                        </button>
                    </form>
                    <p class="text-center mt-4 text-gray-600">
                        Don't have an account? 
                        <button onclick="showSignup()" class="text-blue-600 hover:underline">Sign up</button>
                    </p>
                    <p class="text-center mt-2 text-gray-600">
                        <button onclick="showForgotPassword()" class="text-blue-600 hover:underline text-sm">Forgot your password?</button>
                    </p>
                </div>

                <!-- Forgot Password Form -->
                <div id="forgot-password-form" class="hidden">
                    <h3 class="text-xl font-semibold mb-4 text-center">Reset Password</h3>
                    <p class="text-gray-600 text-sm mb-4 text-center">Enter your email address and we'll send you a password reset link.</p>
                    <form onsubmit="handleForgotPassword(event)">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                            <input type="email" id="forgot-email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <button type="submit" class="w-full bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 transition duration-300">
                            <i class="fas fa-envelope mr-2"></i>Send Reset Email
                        </button>
                    </form>
                    <p class="text-center mt-4 text-gray-600">
                        Remember your password? 
                        <button onclick="showLogin()" class="text-blue-600 hover:underline">Back to Login</button>
                    </p>
                </div>

                <!-- Signup Form -->
                <div id="signup-form" class="hidden">
                    <h3 class="text-xl font-semibold mb-4 text-center">Sign Up</h3>
                    <form onsubmit="handleSignup(event)">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Full Name</label>
                            <input type="text" id="signup-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                            <input type="email" id="signup-email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                            <input type="password" id="signup-password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="admin-signup" onchange="toggleAdminCode()" class="mr-2">
                                <span class="text-sm text-gray-700">Sign up as Admin</span>
                            </label>
                        </div>
                        <div id="admin-code-field" class="mb-4 hidden">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Admin Code</label>
                            <input type="text" id="admin-code" placeholder="Enter admin code" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition duration-300">
                            <i class="fas fa-user-plus mr-2"></i>Sign Up
                        </button>
                    </form>
                    <p class="text-center mt-4 text-gray-600">
                        Already have an account? 
                        <button onclick="showLogin()" class="text-blue-600 hover:underline">Login</button>
                    </p>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="hidden fade-in">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome back, <span id="user-name"></span>!</h2>
                <p class="text-gray-600">Access your course materials, timetable, and announcements</p>
            </div>

            <!-- Quick Access Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6 card-hover cursor-pointer" onclick="showSection('timetable')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Timetable</h3>
                            <p class="text-gray-600 text-sm">View your schedule</p>
                        </div>
                        <i class="fas fa-calendar-alt text-3xl text-blue-600"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 card-hover cursor-pointer" onclick="showSection('materials')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Course Materials</h3>
                            <p class="text-gray-600 text-sm">Access resources</p>
                        </div>
                        <i class="fas fa-book text-3xl text-green-600"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 card-hover cursor-pointer" onclick="showSection('announcements')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Announcements</h3>
                            <p class="text-gray-600 text-sm">Latest updates</p>
                        </div>
                        <i class="fas fa-bullhorn text-3xl text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timetable Section -->
        <div id="timetable-section" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-calendar-alt text-blue-600 mr-3"></i>Timetable
                    </h2>
                    <div id="admin-timetable-controls" class="hidden">
                        <button onclick="editTimetable()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300">
                            <i class="fas fa-edit mr-2"></i>Edit Timetable
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-blue-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Time</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Monday</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Tuesday</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Wednesday</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Thursday</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Friday</th>
                            </tr>
                        </thead>
                        <tbody id="timetable-body">
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-medium bg-gray-50">9:00 - 10:00</td>
                                <td class="border border-gray-300 px-4 py-3">Biochemistry Lecture<br><span class="text-sm text-gray-600">Room A101</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Organic Chemistry<br><span class="text-sm text-gray-600">Room B205</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Lab Session<br><span class="text-sm text-gray-600">Lab 1</span></td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-medium bg-gray-50">10:00 - 11:00</td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Molecular Biology<br><span class="text-sm text-gray-600">Room C301</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Biochemistry Lecture<br><span class="text-sm text-gray-600">Room A101</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-medium bg-gray-50">11:00 - 12:00</td>
                                <td class="border border-gray-300 px-4 py-3">Tutorial<br><span class="text-sm text-gray-600">Room D102</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Lab Session<br><span class="text-sm text-gray-600">Lab 2</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Seminar<br><span class="text-sm text-gray-600">Room E201</span></td>
                            </tr>
                            <tr>
                                                        <tbody id="timetable-body">
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-medium bg-gray-50">9:00 - 10:00</td>
                                <td class="border border-gray-300 px-4 py-3">Biochemistry Lecture<br><span class="text-sm text-gray-600">Room A101</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Organic Chemistry<br><span class="text-sm text-gray-600">Room B205</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Lab Session<br><span class="text-sm text-gray-600">Lab 1</span></td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-medium bg-gray-50">10:00 - 11:00</td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Molecular Biology<br><span class="text-sm text-gray-600">Room C301</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                                <td class="border border-gray-300 px-4 py-3">Biochemistry Lecture<br><span class="text-sm text-gray-600">Room A101</span></td>
                                <td class="border border-gray-300 px-4 py-3">-</td>
                            </tr>
                            <tr>
                                 <tr class="bg-blue-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Time</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">August</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Tuesday</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Wednesday</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Thursday</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Friday</th>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Course Materials Section -->
        <div id="materials-section" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-book text-green-600 mr-3"></i>Course Materials
                    </h2>
                    <div id="admin-materials-controls" class="hidden">
                        <button onclick="uploadMaterial()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-300">
                            <i class="fas fa-upload mr-2"></i>Upload Material
                        </button>
                    </div>
                </div>
                <div id="materials-list" class="space-y-4">
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-file-pdf text-red-500 text-xl"></i>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Biochemistry Chapter 1 - Introduction</h3>
                                    <p class="text-sm text-gray-600">Uploaded 2 days ago • 2.5 MB</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="downloadFile('biochem-ch1.pdf')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="admin-only hidden text-red-600 hover:text-red-800" onclick="deleteMaterial('biochem-ch1.pdf')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-file-powerpoint text-orange-500 text-xl"></i>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Organic Chemistry Slides - Week 3</h3>
                                    <p class="text-sm text-gray-600">Uploaded 1 week ago • 5.1 MB</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="downloadFile('organic-week3.pptx')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="admin-only hidden text-red-600 hover:text-red-800" onclick="deleteMaterial('organic-week3.pptx')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-file-word text-blue-500 text-xl"></i>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Lab Report Template</h3>
                                    <p class="text-sm text-gray-600">Uploaded 2 weeks ago • 1.2 MB</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="downloadFile('lab-template.docx')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="admin-only hidden text-red-600 hover:text-red-800" onclick="deleteMaterial('lab-template.docx')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Announcements Section -->
        <div id="announcements-section" class="hidden fade-in">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-bullhorn text-purple-600 mr-3"></i>Announcements
                    </h2>
                    <div id="admin-announcements-controls" class="hidden">
                        <button onclick="createAnnouncement()" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition duration-300">
                            <i class="fas fa-plus mr-2"></i>New Announcement
                        </button>
                    </div>
                </div>
                <div id="announcements-list" class="space-y-6">
                    <div class="border-l-4 border-blue-500 bg-blue-50 p-4 rounded-r-lg">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-gray-800">Welcome to Biochemistry Helix!</h3>
                            <div class="flex space-x-2">
                                <span class="text-sm text-gray-500">3 days ago</span>
                                <button class="admin-only hidden text-blue-600 hover:text-blue-800" onclick="editAnnouncement(1)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="admin-only hidden text-red-600 hover:text-red-800" onclick="deleteAnnouncement(1)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-700">Welcome to the new student portal! Here you can access all your course materials, check your timetable, and stay updated with the latest announcements. If you have any questions, please don't hesitate to reach out.</p>
                    </div>
                    <div class="border-l-4 border-green-500 bg-green-50 p-4 rounded-r-lg">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-gray-800">Lab Session Update</h3>
                            <div class="flex space-x-2">
                                <span class="text-sm text-gray-500">1 week ago</span>
                                <button class="admin-only hidden text-blue-600 hover:text-blue-800" onclick="editAnnouncement(2)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="admin-only hidden text-red-600 hover:text-red-800" onclick="deleteAnnouncement(2)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-700">Please note that this Friday's lab session has been moved to Lab Room 3 due to equipment maintenance in Lab Room 1. The time remains the same (9:00 - 12:00).</p>
                    </div>
                    <div class="border-l-4 border-yellow-500 bg-yellow-50 p-4 rounded-r-lg">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-gray-800">Assignment Reminder</h3>
                            <div class="flex space-x-2">
                                <span class="text-sm text-gray-500">2 weeks ago</span>
                                <button class="admin-only hidden text-blue-600 hover:text-blue-800" onclick="editAnnouncement(3)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="admin-only hidden text-red-600 hover:text-red-800" onclick="deleteAnnouncement(3)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-700">Don't forget that your first biochemistry assignment is due next Monday. Please submit your reports using the template provided in the course materials section.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for file upload -->
    <div id="upload-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">Upload Course Material</h3>
            <form onsubmit="handleFileUpload(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">File Title</label>
                    <input type="text" id="file-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Select File</label>
                    <input type="file" id="file-input" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeModal('upload-modal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">Upload</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for new announcement -->
    <div id="announcement-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">Create Announcement</h3>
            <form onsubmit="handleAnnouncementCreate(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Title</label>
                    <input type="text" id="announcement-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Message</label>
                    <textarea id="announcement-message" required rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeModal('announcement-modal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700">Post</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let currentSection = 'dashboard';
        
        // Firebase Backend Functions
        class FirebaseBackend {
            static async init() {
                // Wait for Firebase to be available
                while (!window.firebaseAuth || !window.firebaseDb) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // Initialize default data if needed
                await this.initializeDefaultData();
                
                // Set up auth state listener
                window.firebaseServices.onAuthStateChanged(window.firebaseAuth, async (user) => {
                    if (user) {
                        // Get user profile from Firestore
                        const userDoc = await window.firebaseServices.getDoc(
                            window.firebaseServices.doc(window.firebaseDb, 'users', user.uid)
                        );
                        
                        if (userDoc.exists()) {
                            currentUser = {
                                uid: user.uid,
                                email: user.email,
                                ...userDoc.data()
                            };
                            updateUI();
                        }
                    } else {
                        currentUser = null;
                        updateUI();
                    }
                });
            }
            
            static async initializeDefaultData() {
                try {
                    // Check if default admin exists
                    const adminQuery = window.firebaseServices.query(
                        window.firebaseServices.collection(window.firebaseDb, 'users')
                    );
                    const adminSnapshot = await window.firebaseServices.getDocs(adminQuery);
                    
                    if (adminSnapshot.empty) {
                        // Create default admin user (this would normally be done through Firebase Auth)
                        console.log('No users found - default data will be created when admin signs up');
                    }
                    
                    // Initialize default materials if none exist
                    const materialsSnapshot = await window.firebaseServices.getDocs(
                        window.firebaseServices.collection(window.firebaseDb, 'materials')
                    );
                    
                    if (materialsSnapshot.empty) {
                        const defaultMaterials = [
                            { title: 'Biochemistry Chapter 1 - Introduction', filename: 'biochem-ch1.pdf', uploadDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), size: '2.5 MB', uploadedBy: 'admin' },
                            { title: 'Organic Chemistry Slides - Week 3', filename: 'organic-week3.pptx', uploadDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), size: '5.1 MB', uploadedBy: 'admin' },
                            { title: 'Lab Report Template', filename: 'lab-template.docx', uploadDate: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000), size: '1.2 MB', uploadedBy: 'admin' }
                        ];
                        
                        for (const material of defaultMaterials) {
                            await window.firebaseServices.addDoc(
                                window.firebaseServices.collection(window.firebaseDb, 'materials'),
                                material
                            );
                        }
                    }
                    
                    // Initialize default announcements if none exist
                    const announcementsSnapshot = await window.firebaseServices.getDocs(
                        window.firebaseServices.collection(window.firebaseDb, 'announcements')
                    );
                    
                    if (announcementsSnapshot.empty) {
                        const defaultAnnouncements = [
                            { title: 'Welcome to Biochemistry Helix!', message: 'Welcome to the new student portal! Here you can access all your course materials, check your timetable, and stay updated with the latest announcements. If you have any questions, please don\'t hesitate to reach out.', date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000), createdBy: 'admin' },
                            { title: 'Lab Session Update', message: 'Please note that this Friday\'s lab session has been moved to Lab Room 3 due to equipment maintenance in Lab Room 1. The time remains the same (9:00 - 12:00).', date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), createdBy: 'admin' },
                            { title: 'Assignment Reminder', message: 'Don\'t forget that your first biochemistry assignment is due next Monday. Please submit your reports using the template provided in the course materials section.', date: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000), createdBy: 'admin' }
                        ];
                        
                        for (const announcement of defaultAnnouncements) {
                            await window.firebaseServices.addDoc(
                                window.firebaseServices.collection(window.firebaseDb, 'announcements'),
                                announcement
                            );
                        }
                    }
                    
                    // Initialize default timetable if none exists
                    const timetableDoc = await window.firebaseServices.getDoc(
                        window.firebaseServices.doc(window.firebaseDb, 'settings', 'timetable')
                    );
                    
                    if (!timetableDoc.exists()) {
                        const defaultTimetable = [
                            { time: '9:00 - 10:00', monday: 'Biochemistry Lecture\nRoom A101', tuesday: '-', wednesday: 'Organic Chemistry\nRoom B205', thursday: '-', friday: 'Lab Session\nLab 1' },
                            { time: '10:00 - 11:00', monday: '-', tuesday: 'Molecular Biology\nRoom C301', wednesday: '-', thursday: 'Biochemistry Lecture\nRoom A101', friday: '-' },
                            { time: '11:00 - 12:00', monday: 'Tutorial\nRoom D102', tuesday: '-', wednesday: 'Lab Session\nLab 2', thursday: '-', friday: 'Seminar\nRoom E201' }
                        ];
                        
                        await window.firebaseServices.setDoc(
                            window.firebaseServices.doc(window.firebaseDb, 'settings', 'timetable'),
                            { schedule: defaultTimetable }
                        );
                    }
                } catch (error) {
                    console.error('Error initializing default data:', error);
                }
            }
            
            static async getMaterials() {
                try {
                    const materialsSnapshot = await window.firebaseServices.getDocs(
                        window.firebaseServices.query(
                            window.firebaseServices.collection(window.firebaseDb, 'materials'),
                            window.firebaseServices.orderBy('uploadDate', 'desc')
                        )
                    );
                    
                    return materialsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        uploadDate: doc.data().uploadDate?.toDate?.() || doc.data().uploadDate
                    }));
                } catch (error) {
                    console.error('Error getting materials:', error);
                    return [];
                }
            }
            
            static async addMaterial(material) {
                try {
                    const docRef = await window.firebaseServices.addDoc(
                        window.firebaseServices.collection(window.firebaseDb, 'materials'),
                        {
                            ...material,
                            uploadDate: new Date(),
                            uploadedBy: currentUser?.uid || 'unknown'
                        }
                    );
                    return docRef.id;
                } catch (error) {
                    console.error('Error adding material:', error);
                    throw error;
                }
            }
            
            static async deleteMaterial(materialId) {
                try {
                    await window.firebaseServices.deleteDoc(
                        window.firebaseServices.doc(window.firebaseDb, 'materials', materialId)
                    );
                } catch (error) {
                    console.error('Error deleting material:', error);
                    throw error;
                }
            }
            
            static async getAnnouncements() {
                try {
                    const announcementsSnapshot = await window.firebaseServices.getDocs(
                        window.firebaseServices.query(
                            window.firebaseServices.collection(window.firebaseDb, 'announcements'),
                            window.firebaseServices.orderBy('date', 'desc')
                        )
                    );
                    
                    return announcementsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        date: doc.data().date?.toDate?.() || doc.data().date
                    }));
                } catch (error) {
                    console.error('Error getting announcements:', error);
                    return [];
                }
            }
            
            static async addAnnouncement(announcement) {
                try {
                    const docRef = await window.firebaseServices.addDoc(
                        window.firebaseServices.collection(window.firebaseDb, 'announcements'),
                        {
                            ...announcement,
                            date: new Date(),
                            createdBy: currentUser?.uid || 'unknown'
                        }
                    );
                    return docRef.id;
                } catch (error) {
                    console.error('Error adding announcement:', error);
                    throw error;
                }
            }
            
            static async updateAnnouncement(announcementId, updates) {
                try {
                    await window.firebaseServices.updateDoc(
                        window.firebaseServices.doc(window.firebaseDb, 'announcements', announcementId),
                        {
                            ...updates,
                            editedAt: new Date()
                        }
                    );
                } catch (error) {
                    console.error('Error updating announcement:', error);
                    throw error;
                }
            }
            
            static async deleteAnnouncement(announcementId) {
                try {
                    await window.firebaseServices.deleteDoc(
                        window.firebaseServices.doc(window.firebaseDb, 'announcements', announcementId)
                    );
                } catch (error) {
                    console.error('Error deleting announcement:', error);
                    throw error;
                }
            }
            
            static async getTimetable() {
                try {
                    const timetableDoc = await window.firebaseServices.getDoc(
                        window.firebaseServices.doc(window.firebaseDb, 'settings', 'timetable')
                    );
                    
                    if (timetableDoc.exists()) {
                        return timetableDoc.data().schedule || [];
                    }
                    return [];
                } catch (error) {
                    console.error('Error getting timetable:', error);
                    return [];
                }
            }
            
            static async saveTimetable(timetable) {
                try {
                    await window.firebaseServices.setDoc(
                        window.firebaseServices.doc(window.firebaseDb, 'settings', 'timetable'),
                        { schedule: timetable }
                    );
                } catch (error) {
                    console.error('Error saving timetable:', error);
                    throw error;
                }
            }
            
            static formatDate(date) {
                if (!date) return 'Unknown';
                
                const dateObj = date instanceof Date ? date : new Date(date);
                const now = new Date();
                const diffTime = Math.abs(now - dateObj);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                if (diffDays < 30) return `${Math.ceil(diffDays / 7)} weeks ago`;
                return dateObj.toLocaleDateString();
            }
        }

        // Theme management
        let isDarkMode = false;
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            
            if (isDarkMode) {
                body.classList.add('dark');
                themeIcon.className = 'fas fa-sun text-lg';
                localStorage.setItem('theme', 'dark');
                showNotification('Dark mode enabled', 'info');
            } else {
                body.classList.remove('dark');
                themeIcon.className = 'fas fa-moon text-lg';
                localStorage.setItem('theme', 'light');
                showNotification('Light mode enabled', 'info');
            }
        }
        
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                isDarkMode = true;
                document.body.classList.add('dark');
                document.getElementById('theme-icon').className = 'fas fa-sun text-lg';
            }
        }
        
        function goHome() {
            if (currentUser) {
                showSection('dashboard');
                showNotification('Welcome back to the homepage!', 'success');
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async function() {
            loadTheme();
            await FirebaseBackend.init();
            updateUI();
        });

        // Authentication functions
        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                await window.firebaseServices.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                showNotification('Login successful!', 'success');
                // Clear form
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Invalid email or password', 'error');
            }
        }

        async function handleSignup(event) {
            event.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const isAdmin = document.getElementById('admin-signup').checked;
            const adminCode = document.getElementById('admin-code').value;
            
            // Validate admin code if signing up as admin
            if (isAdmin && adminCode !== 'HELIX28') {
                showNotification('Invalid admin code', 'error');
                return;
            }
            
            try {
                // Create user with Firebase Auth
                const userCredential = await window.firebaseServices.createUserWithEmailAndPassword(
                    window.firebaseAuth, 
                    email, 
                    password
                );
                
                // Save user profile to Firestore
                await window.firebaseServices.setDoc(
                    window.firebaseServices.doc(window.firebaseDb, 'users', userCredential.user.uid),
                    {
                        name: name,
                        email: email,
                        role: isAdmin ? 'admin' : 'student',
                        createdAt: new Date()
                    }
                );
                
                showNotification('Account created successfully!', 'success');
                
                // Clear form
                document.getElementById('signup-name').value = '';
                document.getElementById('signup-email').value = '';
                document.getElementById('signup-password').value = '';
                document.getElementById('admin-signup').checked = false;
                document.getElementById('admin-code').value = '';
                document.getElementById('admin-code-field').classList.add('hidden');
            } catch (error) {
                console.error('Signup error:', error);
                if (error.code === 'auth/email-already-in-use') {
                    showNotification('Email already exists', 'error');
                } else if (error.code === 'auth/weak-password') {
                    showNotification('Password should be at least 6 characters', 'error');
                } else {
                    showNotification('Error creating account: ' + error.message, 'error');
                }
            }
        }

        async function logout() {
            try {
                await window.firebaseServices.signOut(window.firebaseAuth);
                showNotification('Logged out successfully', 'success');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Error logging out', 'error');
            }
        }

        // UI update functions
        function updateUI() {
            const authSection = document.getElementById('auth-section');
            const dashboardSection = document.getElementById('dashboard-section');
            const navMenu = document.getElementById('nav-menu');
            const authButtons = document.getElementById('auth-buttons');
            
            if (currentUser) {
                authSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                
                // Update user name
                document.getElementById('user-name').textContent = currentUser.name;
                
                // Update navigation
                navMenu.innerHTML = `
                    <button onclick="showSection('dashboard')" class="hover:text-blue-200 transition duration-300">Dashboard</button>
                    <button onclick="showSection('timetable')" class="hover:text-blue-200 transition duration-300">Timetable</button>
                    <button onclick="showSection('materials')" class="hover:text-blue-200 transition duration-300">Materials</button>
                    <button onclick="showSection('announcements')" class="hover:text-blue-200 transition duration-300">Announcements</button>
                `;
                
                authButtons.innerHTML = `
                    <span class="text-sm">${currentUser.name} (${currentUser.role})</span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm transition duration-300">
                        <i class="fas fa-sign-out-alt mr-1"></i>Logout
                    </button>
                `;
                
                // Show home button when logged in
                document.getElementById('home-button').classList.remove('hidden');
                
                // Show/hide admin controls
                const adminElements = document.querySelectorAll('.admin-only');
                const adminControls = document.querySelectorAll('[id*="admin-"][id*="-controls"]');
                
                if (currentUser.role === 'admin') {
                    adminElements.forEach(el => el.classList.remove('hidden'));
                    adminControls.forEach(el => el.classList.remove('hidden'));
                } else {
                    adminElements.forEach(el => el.classList.add('hidden'));
                    adminControls.forEach(el => el.classList.add('hidden'));
                }
                
                showSection('dashboard');
            } else {
                authSection.classList.remove('hidden');
                dashboardSection.classList.add('hidden');
                navMenu.innerHTML = '';
                authButtons.innerHTML = '';
                document.getElementById('home-button').classList.add('hidden');
                hideAllSections();
            }
        }

        // Section navigation
        function showSection(section) {
            hideAllSections();
            currentSection = section;
            
            if (section === 'dashboard') {
                document.getElementById('dashboard-section').classList.remove('hidden');
            } else {
                document.getElementById('dashboard-section').classList.add('hidden');
                document.getElementById(`${section}-section`).classList.remove('hidden');
                
                // Refresh data when switching sections
                switch(section) {
                    case 'materials':
                        refreshMaterialsList();
                        break;
                    case 'announcements':
                        refreshAnnouncementsList();
                        break;
                    case 'timetable':
                        refreshTimetable();
                        break;
                }
            }
        }

        function hideAllSections() {
            const sections = ['dashboard', 'timetable', 'materials', 'announcements'];
            sections.forEach(section => {
                document.getElementById(`${section}-section`).classList.add('hidden');
            });
        }

        // Auth form switching
        function showSignup() {
            hideAllAuthForms();
            document.getElementById('signup-form').classList.remove('hidden');
        }

        function showLogin() {
            hideAllAuthForms();
            document.getElementById('login-form').classList.remove('hidden');
        }
        
        function showForgotPassword() {
            hideAllAuthForms();
            document.getElementById('forgot-password-form').classList.remove('hidden');
        }
        
        function hideAllAuthForms() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('forgot-password-form').classList.add('hidden');
        }

        function toggleAdminCode() {
            const adminCodeField = document.getElementById('admin-code-field');
            const isChecked = document.getElementById('admin-signup').checked;
            
            if (isChecked) {
                adminCodeField.classList.remove('hidden');
            } else {
                adminCodeField.classList.add('hidden');
            }
        }
        
        // Password reset functions
        async function handleForgotPassword(event) {
            event.preventDefault();
            const email = document.getElementById('forgot-email').value;
            
            try {
                await window.firebaseServices.sendPasswordResetEmail(window.firebaseAuth, email);
                showNotification(`Password reset email sent to ${email}! Check your inbox.`, 'success');
                
                // Clear form and go back to login
                document.getElementById('forgot-email').value = '';
                setTimeout(() => {
                    showLogin();
                }, 2000);
            } catch (error) {
                console.error('Password reset error:', error);
                if (error.code === 'auth/user-not-found') {
                    showNotification('No account found with this email address', 'error');
                } else {
                    showNotification('Error sending reset email: ' + error.message, 'error');
                }
            }
        }
        
        // Note: Firebase handles password reset via email, so we don't need the second step
        function handlePasswordReset(event) {
            event.preventDefault();
            // This function is no longer needed with Firebase Auth
            // Password reset is handled via email link
        }

        // File operations
         function downloadFile(filename) {
        const link = document.createElement('a');
        link.href = `/downloads/${filename}`; // Simulated backend path
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showNotification(`${filename} is downloading...`, 'success');
    }

    // Accept emoji-named files (browser handles emoji in filenames by default)
    document.getElementById('file-input').setAttribute('accept', '*'); // Allows all types including emoji filenames

        function uploadMaterial() {
            document.getElementById('upload-modal').classList.remove('hidden');
        }

        async function handleFileUpload(event) {
            event.preventDefault();
            const title = document.getElementById('file-title').value;
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            
            if (file) {
                try {
                    const newMaterial = {
                        title: title,
                        filename: file.name,
                        size: `${(file.size / 1024 / 1024).toFixed(1)} MB`,
                        uploadedByName: currentUser.name
                    };
                    
                    await FirebaseBackend.addMaterial(newMaterial);
                    await refreshMaterialsList();
                    closeModal('upload-modal');
                    showNotification('Material uploaded successfully!', 'success');
                } catch (error) {
                    console.error('Upload error:', error);
                    showNotification('Error uploading material', 'error');
                }
            }
        }

        async function deleteMaterial(materialId) {
            if (confirm('Are you sure you want to delete this material?')) {
                try {
                    await FirebaseBackend.deleteMaterial(materialId);
                    await refreshMaterialsList();
                    showNotification('Material deleted successfully', 'success');
                } catch (error) {
                    console.error('Delete error:', error);
                    showNotification('Error deleting material', 'error');
                }
            }
        }

        async function refreshMaterialsList() {
            const materials = await FirebaseBackend.getMaterials();
            const materialsList = document.getElementById('materials-list');
            
            if (materials.length === 0) {
                materialsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-folder-open text-4xl mb-4"></i>
                        <p>No materials uploaded yet.</p>
                    </div>
                `;
                return;
            }
            
            materialsList.innerHTML = materials.map(material => `
                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition duration-300">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-file-${getFileIcon(material.filename)} text-xl"></i>
                            <div>
                                <h3 class="font-semibold text-gray-800">${material.title}</h3>
                                <p class="text-sm text-gray-600">
                                    Uploaded ${FirebaseBackend.formatDate(material.uploadDate)} • ${material.size}
                                    ${material.uploadedByName ? ` • by ${material.uploadedByName}` : ''}
                                </p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="downloadFile('${material.filename}')" class="text-blue-600 hover:text-blue-800 p-2 rounded hover:bg-blue-50" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="admin-only ${currentUser?.role !== 'admin' ? 'hidden' : ''} text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50" onclick="deleteMaterial('${material.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            switch (ext) {
                case 'pdf': return 'pdf text-red-500';
                case 'ppt':
                case 'pptx': return 'powerpoint text-orange-500';
                case 'doc':
                case 'docx': return 'word text-blue-500';
                default: return 'alt text-gray-500';
            }
        }

        // Announcement operations
        function createAnnouncement() {
            document.getElementById('announcement-modal').classList.remove('hidden');
        }

        async function handleAnnouncementCreate(event) {
            event.preventDefault();
            const title = document.getElementById('announcement-title').value;
            const message = document.getElementById('announcement-message').value;
            
            try {
                const newAnnouncement = {
                    title: title,
                    message: message,
                    createdByName: currentUser.name
                };
                
                await FirebaseBackend.addAnnouncement(newAnnouncement);
                await refreshAnnouncementsList();
                closeModal('announcement-modal');
                showNotification('Announcement posted successfully!', 'success');
            } catch (error) {
                console.error('Create announcement error:', error);
                showNotification('Error creating announcement', 'error');
            }
        }

        async function editAnnouncement(id) {
            try {
                const announcements = await FirebaseBackend.getAnnouncements();
                const announcement = announcements.find(a => a.id === id);
                if (announcement) {
                    const newTitle = prompt('Edit title:', announcement.title);
                    const newMessage = prompt('Edit message:', announcement.message);
                    
                    if (newTitle !== null && newMessage !== null) {
                        await FirebaseBackend.updateAnnouncement(id, {
                            title: newTitle,
                            message: newMessage
                        });
                        await refreshAnnouncementsList();
                        showNotification('Announcement updated successfully!', 'success');
                    }
                }
            } catch (error) {
                console.error('Edit announcement error:', error);
                showNotification('Error updating announcement', 'error');
            }
        }

        async function deleteAnnouncement(id) {
            if (confirm('Are you sure you want to delete this announcement?')) {
                try {
                    await FirebaseBackend.deleteAnnouncement(id);
                    await refreshAnnouncementsList();
                    showNotification('Announcement deleted successfully', 'success');
                } catch (error) {
                    console.error('Delete announcement error:', error);
                    showNotification('Error deleting announcement', 'error');
                }
            }
        }

        async function refreshAnnouncementsList() {
            const announcements = await FirebaseBackend.getAnnouncements();
            const announcementsList = document.getElementById('announcements-list');
            const colors = ['blue', 'green', 'yellow', 'purple', 'indigo'];
            
            if (announcements.length === 0) {
                announcementsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-bullhorn text-4xl mb-4"></i>
                        <p>No announcements yet.</p>
                    </div>
                `;
                return;
            }
            
            announcementsList.innerHTML = announcements.map((announcement, index) => {
                const color = colors[index % colors.length];
                return `
                    <div class="border-l-4 border-${color}-500 bg-${color}-50 p-4 rounded-r-lg">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-gray-800">${announcement.title}</h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500">${FirebaseBackend.formatDate(announcement.date)}</span>
                                <button class="admin-only ${currentUser?.role !== 'admin' ? 'hidden' : ''} text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100" onclick="editAnnouncement('${announcement.id}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="admin-only ${currentUser?.role !== 'admin' ? 'hidden' : ''} text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100" onclick="deleteAnnouncement('${announcement.id}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-700">${announcement.message}</p>
                        ${announcement.createdByName ? `<p class="text-xs text-gray-500 mt-2">Posted by ${announcement.createdByName}</p>` : ''}
                        ${announcement.editedAt ? `<p class="text-xs text-gray-500">Last edited ${FirebaseBackend.formatDate(announcement.editedAt)}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Timetable operations
        let currentTimetable = [];
        
        async function editTimetable() {
            currentTimetable = await FirebaseBackend.getTimetable();
            const timetableBody = document.getElementById('timetable-body');
            
            // Make cells editable
            timetableBody.innerHTML = currentTimetable.map((row, rowIndex) => `
                <tr>
                    <td class="border border-gray-300 px-4 py-3 font-medium bg-gray-50">${row.time}</td>
                    <td class="border border-gray-300 px-2 py-2">
                        <textarea class="w-full p-2 text-sm border-0 resize-none bg-transparent" 
                                  rows="2" 
                                  onchange="updateTimetableCell(${rowIndex}, 'monday', this.value)">${row.monday}</textarea>
                    </td>
                    <td class="border border-gray-300 px-2 py-2">
                        <textarea class="w-full p-2 text-sm border-0 resize-none bg-transparent" 
                                  rows="2" 
                                  onchange="updateTimetableCell(${rowIndex}, 'tuesday', this.value)">${row.tuesday}</textarea>
                    </td>
                    <td class="border border-gray-300 px-2 py-2">
                        <textarea class="w-full p-2 text-sm border-0 resize-none bg-transparent" 
                                  rows="2" 
                                  onchange="updateTimetableCell(${rowIndex}, 'wednesday', this.value)">${row.wednesday}</textarea>
                    </td>
                    <td class="border border-gray-300 px-2 py-2">
                        <textarea class="w-full p-2 text-sm border-0 resize-none bg-transparent" 
                                  rows="2" 
                                  onchange="updateTimetableCell(${rowIndex}, 'thursday', this.value)">${row.thursday}</textarea>
                    </td>
                    <td class="border border-gray-300 px-2 py-2">
                        <textarea class="w-full p-2 text-sm border-0 resize-none bg-transparent" 
                                  rows="2" 
                                  onchange="updateTimetableCell(${rowIndex}, 'friday', this.value)">${row.friday}</textarea>
                    </td>
                </tr>
            `).join('');
            
            // Update button to save
            const editButton = document.querySelector('#admin-timetable-controls button');
            editButton.innerHTML = '<i class="fas fa-save mr-2"></i>Save Timetable';
            editButton.onclick = saveTimetable;
            
            showNotification('Timetable is now editable. Click cells to modify.', 'info');
        }
        
        function updateTimetableCell(rowIndex, day, value) {
            currentTimetable[rowIndex][day] = value;
        }
        
        async function saveTimetable() {
            try {
                await FirebaseBackend.saveTimetable(currentTimetable);
                await refreshTimetable();
                const editButton = document.querySelector('#admin-timetable-controls button');
                editButton.innerHTML = '<i class="fas fa-edit mr-2"></i>Edit Timetable';
                editButton.onclick = editTimetable;
                showNotification('Timetable saved successfully!', 'success');
            } catch (error) {
                console.error('Save timetable error:', error);
                showNotification('Error saving timetable', 'error');
            }
        }
        
        async function refreshTimetable() {
            const timetable = await FirebaseBackend.getTimetable();
            const timetableBody = document.getElementById('timetable-body');
            
            timetableBody.innerHTML = timetable.map(row => `
                <tr>
                    <td class="border border-gray-300 px-4 py-3 font-medium bg-gray-50">${row.time}</td>
                    <td class="border border-gray-300 px-4 py-3">${row.monday.replace(/\n/g, '<br><span class="text-sm text-gray-600">')}</span></td>
                    <td class="border border-gray-300 px-4 py-3">${row.tuesday.replace(/\n/g, '<br><span class="text-sm text-gray-600">')}</span></td>
                    <td class="border border-gray-300 px-4 py-3">${row.wednesday.replace(/\n/g, '<br><span class="text-sm text-gray-600">')}</span></td>
                    <td class="border border-gray-300 px-4 py-3">${row.thursday.replace(/\n/g, '<br><span class="text-sm text-gray-600">')}</span></td>
                    <td class="border border-gray-300 px-4 py-3">${row.friday.replace(/\n/g, '<br><span class="text-sm text-gray-600">')}</span></td>
                </tr>
            `).join('');
        }

        // Modal operations
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            // Reset form if it exists
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('[id$="-modal"]');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a178c8067437b6',t:'MTc1NDM0NjMzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>



